{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/ormico/Export-SqlServerSchema/export-import-config.schema.json",
  "title": "Export-SqlServerSchema Configuration",
  "description": "Configuration schema for SQL Server schema export and import operations",
  "type": "object",
  "properties": {
    "connectionTimeout": {
      "type": "integer",
      "description": "Connection timeout in seconds (time to wait when establishing connection)",
      "default": 30,
      "minimum": 1,
      "maximum": 300
    },
    "commandTimeout": {
      "type": "integer",
      "description": "Command/query timeout in seconds (time to wait for SQL commands to complete)",
      "default": 300,
      "minimum": 1,
      "maximum": 3600
    },
    "maxRetries": {
      "type": "integer",
      "description": "Maximum retry attempts for transient failures (network timeouts, Azure SQL throttling, deadlocks)",
      "default": 3,
      "minimum": 1,
      "maximum": 10
    },
    "retryDelaySeconds": {
      "type": "integer",
      "description": "Initial retry delay in seconds (uses exponential backoff - doubles each retry)",
      "default": 2,
      "minimum": 1,
      "maximum": 60
    },
    "trustServerCertificate": {
      "type": "boolean",
      "description": "Trust server certificate (required for SQL Server with self-signed certificates). Set to true for local/dev environments with self-signed certs, false for production with valid certificates.",
      "default": false
    },
    "importMode": {
      "type": "string",
      "enum": ["Dev", "Prod"],
      "description": "Simplified import mode setting (alternative to import.defaultMode). Dev = developer mode (default, skips infrastructure), Prod = production mode (full import)",
      "default": "Dev"
    },
    "includeData": {
      "type": "boolean",
      "description": "Simplified data import setting (alternative to import.developerMode.includeData or import.productionMode.includeData). When true, imports table data.",
      "default": false
    },
    "collectMetrics": {
      "type": "boolean",
      "description": "Collect performance metrics and save to JSON file. Useful for benchmarking export/import operations.",
      "default": false
    },
    "targetSqlVersion": {
      "type": "string",
      "enum": ["Sql2012", "Sql2014", "Sql2016", "Sql2017", "Sql2019", "Sql2022"],
      "description": "Target SQL Server version for generated scripts. Affects syntax compatibility.",
      "default": "Sql2022"
    },
    "export": {
      "type": "object",
      "description": "Export operation settings",
      "properties": {
        "includeObjectTypes": {
          "type": "array",
          "description": "Object types to include in export (if specified, only these types are exported). Mutually exclusive with excludeObjectTypes.",
          "items": {
            "type": "string",
            "enum": [
              "FileGroups",
              "DatabaseScopedConfigurations",
              "DatabaseScopedCredentials",
              "Schemas",
              "Sequences",
              "PartitionFunctions",
              "PartitionSchemes",
              "UserDefinedTypes",
              "XmlSchemaCollections",
              "Tables",
              "ForeignKeys",
              "Indexes",
              "Defaults",
              "Rules",
              "Assemblies",
              "Functions",
              "UserDefinedAggregates",
              "StoredProcedures",
              "DatabaseTriggers",
              "TableTriggers",
              "Views",
              "Synonyms",
              "FullTextCatalogs",
              "ExternalDataSources",
              "ExternalFileFormats",
              "SearchPropertyLists",
              "PlanGuides",
              "DatabaseRoles",
              "DatabaseUsers",
              "WindowsUsers",
              "SqlUsers",
              "ExternalUsers",
              "CertificateMappedUsers",
              "SecurityObjects",
              "SecurityPolicies",
              "Data"
            ]
          },
          "uniqueItems": true
        },
        "excludeObjectTypes": {
          "type": "array",
          "description": "Object types to exclude from export (all included by default)",
          "items": {
            "type": "string",
            "enum": [
              "FileGroups",
              "DatabaseScopedConfigurations",
              "DatabaseScopedCredentials",
              "Schemas",
              "Sequences",
              "PartitionFunctions",
              "PartitionSchemes",
              "UserDefinedTypes",
              "XmlSchemaCollections",
              "Tables",
              "ForeignKeys",
              "Indexes",
              "Defaults",
              "Rules",
              "Assemblies",
              "Functions",
              "UserDefinedAggregates",
              "StoredProcedures",
              "DatabaseTriggers",
              "TableTriggers",
              "Views",
              "Synonyms",
              "FullTextCatalogs",
              "ExternalDataSources",
              "ExternalFileFormats",
              "SearchPropertyLists",
              "PlanGuides",
              "DatabaseRoles",
              "DatabaseUsers",
              "WindowsUsers",
              "SqlUsers",
              "ExternalUsers",
              "CertificateMappedUsers",
              "SecurityObjects",
              "SecurityPolicies",
              "Data"
            ]
          },
          "uniqueItems": true
        },
        "includeData": {
          "type": "boolean",
          "description": "Export table data as INSERT statements",
          "default": false
        },
        "excludeObjects": {
          "type": "array",
          "description": "Specific objects to exclude using schema.name pattern (supports wildcards)",
          "items": {
            "type": "string",
            "pattern": "^[\\w\\*]+\\.[\\w\\*]+$"
          },
          "examples": [
            "dbo.LegacyTable",
            "staging.*",
            "*.TempTable"
          ]
        },
        "excludeSchemas": {
          "type": "array",
          "description": "Schemas to exclude entirely from export",
          "items": {
            "type": "string"
          },
          "examples": ["staging", "temp", "archive"]
        },
        "groupByObjectTypes": {
          "type": "object",
          "description": "File grouping strategy per object type: 'single' = one file per object (default), 'schema' = group by schema, 'all' = all in one file",
          "properties": {
            "FileGroups": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "DatabaseScopedConfigurations": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "DatabaseScopedCredentials": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Schemas": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Sequences": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "PartitionFunctions": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "PartitionSchemes": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "UserDefinedTypes": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "XmlSchemaCollections": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Tables": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "ForeignKeys": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Indexes": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Defaults": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Rules": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Assemblies": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Functions": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "UserDefinedAggregates": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "StoredProcedures": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "DatabaseTriggers": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "TableTriggers": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Views": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "Synonyms": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "FullTextCatalogs": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "ExternalDataSources": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "ExternalFileFormats": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "SearchPropertyLists": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "PlanGuides": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "SecurityObjects": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"},
            "SecurityPolicies": {"type": "string", "enum": ["single", "schema", "all"], "default": "single"}
          },
          "additionalProperties": false
        },
        "parallel": {
          "type": "object",
          "description": "Parallel export configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable parallel export processing"
            },
            "maxWorkers": {
              "type": "integer",
              "minimum": 1,
              "maximum": 20,
              "default": 5,
              "description": "Maximum number of parallel worker threads"
            },
            "progressInterval": {
              "type": "integer",
              "minimum": 1,
              "default": 50,
              "description": "Report progress every N work items completed"
            }
          },
          "additionalProperties": false
        },
        "deltaFrom": {
          "type": "string",
          "description": "Path to previous export for delta/incremental export. Only changed objects will be re-exported."
        }
      },
      "additionalProperties": false
    },
    "import": {
      "type": "object",
      "description": "Import operation settings",
      "properties": {
        "defaultMode": {
          "type": "string",
          "enum": ["Dev", "Prod"],
          "description": "Default import mode (Dev or Prod)",
          "default": "Dev"
        },
        "createDatabase": {
          "type": "boolean",
          "description": "Create target database if it does not exist. Requires appropriate server-level permissions.",
          "default": false
        },
        "force": {
          "type": "boolean",
          "description": "Skip check for existing schema and apply all scripts. Use with caution in production.",
          "default": false
        },
        "continueOnError": {
          "type": "boolean",
          "description": "Continue applying scripts even if individual scripts fail. Useful for idempotent applications.",
          "default": false
        },
        "showSql": {
          "type": "boolean",
          "description": "Display SQL scripts during execution for debugging.",
          "default": false
        },
        "includeObjectTypes": {
          "type": "array",
          "description": "Object types to include in import (if specified, only these types are imported)",
          "items": {
            "type": "string",
            "enum": [
              "FileGroups",
              "DatabaseConfiguration",
              "Schemas",
              "Sequences",
              "PartitionFunctions",
              "PartitionSchemes",
              "Types",
              "XmlSchemaCollections",
              "Tables",
              "ForeignKeys",
              "Indexes",
              "Defaults",
              "Rules",
              "Programmability",
              "Views",
              "Functions",
              "StoredProcedures",
              "Synonyms",
              "SearchPropertyLists",
              "PlanGuides",
              "DatabaseRoles",
              "DatabaseUsers",
              "SecurityPolicies",
              "Data"
            ]
          },
          "uniqueItems": true
        },
        "dependencyRetries": {
          "type": "object",
          "description": "Retry settings for handling cross-object dependencies in programmability objects",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable dependency retry logic for programmability objects (Functions, StoredProcedures, Views)",
              "default": true
            },
            "maxRetries": {
              "type": "integer",
              "description": "Maximum retry attempts for resolving object dependencies",
              "default": 10,
              "minimum": 1,
              "maximum": 10
            },
            "objectTypes": {
              "type": "array",
              "description": "Object types to include in dependency retry group (retried together to resolve cross-type dependencies)",
              "items": {
                "type": "string",
                "enum": ["Functions", "StoredProcedures", "Views", "Synonyms", "TableTriggers", "DatabaseTriggers"]
              },
              "default": ["Functions", "StoredProcedures", "Views"],
              "uniqueItems": true
            }
          },
          "additionalProperties": false
        },
        "developerMode": {
          "$ref": "#/definitions/importSettings",
          "description": "Settings for developer mode imports"
        },
        "productionMode": {
          "$ref": "#/definitions/importSettings",
          "description": "Settings for production mode imports"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "definitions": {
    "importSettings": {
      "type": "object",
      "description": "Import mode settings",
      "properties": {
        "fileGroupStrategy": {
          "type": "string",
          "enum": ["autoRemap", "removeToPrimary"],
          "description": "FileGroup handling strategy (autoRemap = import FileGroups with auto-detected paths, removeToPrimary = skip FileGroups and remap all ON clauses to PRIMARY)",
          "default": "autoRemap"
        },
        "includeConfigurations": {
          "type": "boolean",
          "description": "Import database scoped configurations",
          "default": false
        },
        "includeDatabaseScopedCredentials": {
          "type": "boolean",
          "const": false,
          "description": "Always false - credentials require manual setup (cannot be imported)"
        },
        "includeExternalData": {
          "type": "boolean",
          "description": "Import external data sources and file formats",
          "default": false
        },
        "enableSecurityPolicies": {
          "type": "boolean",
          "description": "Enable Row-Level Security policies (true = STATE ON, false = STATE OFF)",
          "default": false
        },
        "includeData": {
          "type": "boolean",
          "description": "Import table data",
          "default": false
        },
        "excludeObjectTypes": {
          "type": "array",
          "description": "Object types to exclude from import in this mode",
          "items": {
            "type": "string",
            "enum": [
              "PlanGuides",
              "ExternalLibraries",
              "ExternalLanguages",
              "SearchPropertyLists",
              "Synonyms"
            ]
          },
          "uniqueItems": true
        },
        "fileGroupPathMapping": {
          "type": "object",
          "description": "Map FileGroup names to physical paths (used with fileGroupStrategy: autoRemap when paths cannot be auto-detected)",
          "additionalProperties": {
            "type": "string",
            "description": "Physical path for FileGroup data files"
          },
          "examples": [
            {
              "FG_CURRENT": "E:\\SQLData\\Current",
              "FG_ARCHIVE": "F:\\SQLArchive\\Archive"
            }
          ]
        },
        "fileGroupFileSizeDefaults": {
          "type": "object",
          "description": "Override file SIZE and FILEGROWTH for FileGroup data files (prevents large allocations on dev systems)",
          "properties": {
            "sizeKB": {
              "type": "integer",
              "description": "Initial file size in KB (default: 1024 = 1MB)",
              "default": 1024,
              "minimum": 64,
              "maximum": 1073741824
            },
            "fileGrowthKB": {
              "type": "integer",
              "description": "File growth increment in KB (default: 65536 = 64MB)",
              "default": 65536,
              "minimum": 64,
              "maximum": 1073741824
            }
          },
          "additionalProperties": false,
          "examples": [
            {
              "sizeKB": 1024,
              "fileGrowthKB": 65536
            },
            {
              "sizeKB": 10240,
              "fileGrowthKB": 102400
            }
          ]
        },
        "externalConnectionStrings": {
          "type": "object",
          "description": "Map external data source names to connection URLs",
          "additionalProperties": {
            "type": "string",
            "format": "uri",
            "description": "Connection URL for external data source"
          },
          "examples": [
            {
              "AzureDataLake": "https://proddatalake.blob.core.windows.net/data",
              "AzureBackup": "https://prodbackup.blob.core.windows.net/backup"
            }
          ]
        }
      },
      "additionalProperties": false
    }
  }
}
